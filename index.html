<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–Ω–∞–ª–∏–∑ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Ä–µ–∑—é–º–µ –∏ –≤–∞–∫–∞–Ω—Å–∏–π</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .form-group {
            margin-bottom: 30px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }

        .form-group input[type="file"],
        .form-group input[type="url"] {
            width: 100%;
            padding: 15px;
            border: 2px dashed #667eea;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-group input[type="file"]:hover,
        .form-group input[type="url"]:hover {
            border-color: #764ba2;
        }

        .form-group input[type="url"] {
            border-style: solid;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            display: none;
            margin-top: 40px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .results.active {
            display: block;
        }

        .compatibility-score {
            text-align: center;
            margin-bottom: 30px;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            font-weight: bold;
            color: white;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .score-label {
            margin-top: 15px;
            font-size: 1.2em;
            color: #333;
            font-weight: 600;
        }

        .section {
            margin-bottom: 30px;
        }

        .section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .gaps-list {
            list-style: none;
        }

        .gaps-list li {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #ff6b6b;
        }

        .gaps-list li strong {
            color: #ff6b6b;
        }

        .recommendations-list {
            list-style: none;
        }

        .recommendations-list li {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #51cf66;
        }

        .recommendations-list li::before {
            content: "‚úì ";
            color: #51cf66;
            font-weight: bold;
            margin-right: 10px;
        }

        .skills-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .skills-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
        }

        .skills-box h4 {
            margin-bottom: 15px;
            color: #667eea;
        }

        .skill-tag {
            display: inline-block;
            background: #e9ecef;
            padding: 5px 12px;
            border-radius: 20px;
            margin: 5px;
            font-size: 0.9em;
        }

        .error {
            background: #ff6b6b;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
            white-space: pre-line;
            line-height: 1.6;
        }

        .error.active {
            display: block;
        }

        @media (max-width: 768px) {
            .skills-comparison {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìÑ –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—é–º–µ –∏ –≤–∞–∫–∞–Ω—Å–∏–π</h1>
            <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ä–µ–∑—é–º–µ –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏</p>
        </div>

        <div class="content">
            <form id="analysisForm">
                <div class="form-group">
                    <label for="resume">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∞—à–µ —Ä–µ–∑—é–º–µ (PDF, DOCX, TXT)</label>
                    <input type="file" id="resume" name="resume" accept=".pdf,.docx,.txt" required>
                </div>

                <div class="form-group">
                    <label for="jobUrl">–°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é</label>
                    <input type="url" id="jobUrl" name="job_url" placeholder="https://example.com/job" required>
                </div>

                <button type="submit" class="btn" id="submitBtn">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
            </form>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p style="margin-top: 15px;">–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–∑—é–º–µ –∏ –≤–∞–∫–∞–Ω—Å–∏—é...</p>
            </div>

            <div class="error" id="error"></div>

            <div class="results" id="results">
                <div class="compatibility-score">
                    <div class="score-circle" id="scoreCircle">0%</div>
                    <div class="score-label">–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å</div>
                </div>

                <div class="section">
                    <h3>üîç Gap-–∞–Ω–∞–ª–∏–∑ (—á–µ–≥–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç)</h3>
                    <ul class="gaps-list" id="gapsList"></ul>
                </div>

                <div class="section">
                    <h3>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>
                    <ul class="recommendations-list" id="recommendationsList"></ul>
                </div>

                <div class="section">
                    <h3>üõ†Ô∏è –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–∞–≤—ã–∫–æ–≤</h3>
                    <div class="skills-comparison">
                        <div class="skills-box">
                            <h4>–ù–∞–≤—ã–∫–∏ –≤ —Ä–µ–∑—é–º–µ</h4>
                            <div id="resumeSkills"></div>
                        </div>
                        <div class="skills-box">
                            <h4>–¢—Ä–µ–±—É–µ–º—ã–µ –Ω–∞–≤—ã–∫–∏</h4>
                            <div id="jobSkills"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('analysisForm');
        const loading = document.getElementById('loading');
        const results = document.getElementById('results');
        const error = document.getElementById('error');
        const submitBtn = document.getElementById('submitBtn');

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', async () => {
            try {
                const response = await fetch('/api/health');
                if (!response.ok) {
                    console.warn('–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É');
                }
            } catch (err) {
                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞:', err);
                // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ
                // –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –µ—â–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω
            }
        });

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData();
            const resumeFile = document.getElementById('resume').files[0];
            const jobUrl = document.getElementById('jobUrl').value;

            if (!resumeFile || !jobUrl) {
                showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }

            formData.append('resume', resumeFile);
            formData.append('job_url', jobUrl);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            loading.classList.add('active');
            results.classList.remove('active');
            error.classList.remove('active');
            submitBtn.disabled = true;

            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    body: formData
                });

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—É—á–∏–ª–∏ –æ—Ç–≤–µ—Ç
                if (!response) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω.');
                }

                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å JSON –∏–ª–∏ —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏)
                const responseText = await response.text();
                
                // –ü—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∫–∞–∫ JSON
                let data;
                try {
                    data = JSON.parse(responseText);
                } catch (jsonError) {
                    // –ï—Å–ª–∏ –Ω–µ JSON, –∑–Ω–∞—á–∏—Ç —ç—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤–∞—è –æ—à–∏–±–∫–∞
                    if (!response.ok) {
                        throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (${response.status}): ${responseText || response.statusText}`);
                    } else {
                        throw new Error(`–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: ${responseText.substring(0, 100)}`);
                    }
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞
                if (!response.ok) {
                    const errorMsg = data.detail || data.message || `–û—à–∏–±–∫–∞ ${response.status}: ${response.statusText}`;
                    throw new Error(errorMsg);
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏
                if (data.success) {
                    displayResults(data.result);
                } else {
                    throw new Error(data.message || data.detail || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                }

            } catch (err) {
                let errorMessage = err.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.';
                
                // –ë–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
                if (err.message.includes('fetch') || err.message.includes('Failed to fetch') || err.message.includes('NetworkError')) {
                    errorMessage = '‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É.\n\n' +
                        '–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:\n' +
                        '1. –°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –∫–æ–º–∞–Ω–¥—É: uvicorn main:app --reload\n' +
                        '2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ—Ç–∫—Ä—ã–ª–∏ http://localhost:8000\n' +
                        '3. –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ';
                } else if (err.message.includes('CORS') || err.message.includes('CORS policy')) {
                    errorMessage = '‚ùå –û—à–∏–±–∫–∞ CORS. –°–µ—Ä–≤–µ—Ä –Ω–µ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Å —ç—Ç–æ–≥–æ –¥–æ–º–µ–Ω–∞.';
                } else if (err.message.includes('timeout') || err.message.includes('Timeout')) {
                    errorMessage = '‚ùå –ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é.';
                }
                
                showError(errorMessage);
            } finally {
                loading.classList.remove('active');
                submitBtn.disabled = false;
            }
        });

        function displayResults(result) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
            const score = result.compatibility_percentage;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.textContent = score + '%';

            // –¶–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–∞
            if (score >= 70) {
                scoreCircle.style.background = 'linear-gradient(135deg, #51cf66 0%, #40c057 100%)';
            } else if (score >= 50) {
                scoreCircle.style.background = 'linear-gradient(135deg, #ffd43b 0%, #fcc419 100%)';
            } else {
                scoreCircle.style.background = 'linear-gradient(135deg, #ff6b6b 0%, #fa5252 100%)';
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º gaps
            const gapsList = document.getElementById('gapsList');
            gapsList.innerHTML = '';
            if (result.gaps && result.gaps.length > 0) {
                result.gaps.forEach(gap => {
                    const li = document.createElement('li');
                    li.innerHTML = `<strong>${gap.category}:</strong> ${gap.description}`;
                    gapsList.appendChild(li);
                });
            } else {
                gapsList.innerHTML = '<li>–û—Ç–ª–∏—á–Ω–æ! –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã.</li>';
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
            const recommendationsList = document.getElementById('recommendationsList');
            recommendationsList.innerHTML = '';
            if (result.recommendations && result.recommendations.length > 0) {
                result.recommendations.forEach(rec => {
                    const li = document.createElement('li');
                    li.textContent = rec;
                    recommendationsList.appendChild(li);
                });
            } else {
                recommendationsList.innerHTML = '<li>–í–∞—à–µ —Ä–µ–∑—é–º–µ —Ö–æ—Ä–æ—à–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–∞–∫–∞–Ω—Å–∏–∏!</li>';
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–≤—ã–∫–∏
            const resumeSkillsDiv = document.getElementById('resumeSkills');
            resumeSkillsDiv.innerHTML = '';
            if (result.resume_skills && result.resume_skills.length > 0) {
                result.resume_skills.forEach(skill => {
                    const tag = document.createElement('span');
                    tag.className = 'skill-tag';
                    tag.textContent = skill;
                    resumeSkillsDiv.appendChild(tag);
                });
            } else {
                resumeSkillsDiv.textContent = '–ù–∞–≤—ã–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã';
            }

            const jobSkillsDiv = document.getElementById('jobSkills');
            jobSkillsDiv.innerHTML = '';
            if (result.job_skills && result.job_skills.length > 0) {
                result.job_skills.forEach(skill => {
                    const tag = document.createElement('span');
                    tag.className = 'skill-tag';
                    tag.textContent = skill;
                    jobSkillsDiv.appendChild(tag);
                });
            } else {
                jobSkillsDiv.textContent = '–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –Ω–∞–≤—ã–∫–∞–º –Ω–µ –Ω–∞–π–¥–µ–Ω—ã';
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            results.classList.add('active');
        }

        function showError(message) {
            // –ó–∞–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –Ω–∞ HTML —Ç–µ–≥–∏ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const formattedMessage = message.replace(/\n/g, '<br>');
            error.innerHTML = formattedMessage;
            error.classList.add('active');
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –æ—à–∏–±–∫–µ
            error.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    </script>
</body>
</html>

